<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css" />
    <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII" />
    <title text="Reset Password">reset</title>
</head>

<body>
    <div style="width: 350px" class="border border-secondary p-3 rounded">
        <div class="container vh-100 text-center">
            <h1 th:text="#{message.resetPassword}">Reset your password</h1>
            <div style="width: 350px" class="row h-100 justify-content-center align-items-center">
                <form class="col-12" action="#">
                    <label text="Email:">Please enter your email:</label>
                    <input class="form-control" id="email" name="email" type="email" value=""
                            required="required" placeholder="email"/>
                    <button class="btn btn-primary" type="submit" text="Reset Password">Reset</button>
                </form>
                <span>Register <a th:href="@{/register}" text="Sign up">here</a>.</span>
                <br /><br />
                <span>Back to <a th:href="@{/login}" text="Back to login">login</a>.</span>
            </div>
        </div>
    </div>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script th:inline="javascript">
        var serverContext = [[@{/}]];

        $(document).ready(function () {
            $('form').submit(function (event) {
                resetPass(event);
            });
        });

        function resetPass(event) {
            event.preventDefault();
            var email = $("#email").val();
            $.post(serverContext + "user/resetPassword", { email: email }, function (data) {
                window.location.href = serverContext + "login?message=" + data.message;
            })
                .fail(function (data) {
                    if (data.responseJSON.error.indexOf("MailError") > -1) {
                        window.location.href = serverContext + "emailError.html";
                    }
                    else {
                        window.location.href = serverContext + "login?message=" + data.responseJSON.message;
                    }
                });
        }

        $(document).ajaxStart(function () {
            $("title").html("LOADING ...");
        });
    </script>
</body>

</html>